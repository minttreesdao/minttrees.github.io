<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            background-image: url('rock_scissors_paper.jpeg'); 
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: center;
            padding: 50px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
        }
        
        .chains {
            display: flex;
            justify-content: center;
            padding: 10px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .main {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        @media screen and (max-width: 600px) {
            .container {
                width: 90%;
            }
        }
    </style>
</head>
<body>
    <div class="main">
        <div class="chains">
            <p>Available Chains: Mumbai, zkSync Goerli, zkSync Era</p>
        </div>
    <div class="container">
        <h2> </h2>
        <label for="move">Choose a move:</label>
        <select id="move" name="move">
          <option value="Rock">Rock</option>
          <option value="Scissors">Scissors</option>
          <option value="Paper">Paper</option>
        </select>
        <br>
        <label for="secret">Enter a secret:</label>
        <input type="text" id="secret" name="secret">
        <br>
        <button id="joinButton">Let's Play</button>
        <br>
        <button id="resetButton">Reset Game</button>
        <br>
        <p id="status"></p>
        <p id="contractMove"></p>
        <p id="winner"></p>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
    <script>
        window.addEventListener('load', async () => {
            // Modern dapp browsers...
            if (window.ethereum) {
                window.web3 = new Web3(ethereum);
                try {
                    // Request account access if needed
                    await ethereum.enable();
                } catch (error) {
                    // User denied account access...
                }
            }
            // Legacy dapp browsers...
            else if (window.web3) {
                window.web3 = new Web3(web3.currentProvider);
            }
            // Non-dapp browsers...
            else {
                console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');
            }

            const moves = {
                'Rock': 1,
                'Scissors': 2,
                'Paper': 3
            };

            const networkId = await web3.eth.net.getId();
            let contractAddress;
            switch (networkId) {
              case 80001: // Polygon Mumbai
                contractAddress = '0x1beEe9EbE0465611eb87Fd93f0aC0c197aCfb209';
                break;
              case 280: // zkSync Era Testnet
                contractAddress = '0x4604B0fa21a96F5FF2EB464a09E6d3b7f817E627';
                break;
              case 8453: // Base
                contractAddress = 'mainnet_contract_address';
                break;
              case 59144: // Linea
                contractAddress = 'rinkeby_contract_address';
                break;
              case 1101: // Polygon zkEVM
                contractAddress = 'optimism_contract_address';
                break;
              case 324: // zkSync Era
                contractAddress = '0xCE76Ae7b0Dc32E05652B2874b7f4292B31B8386B';
                break;
              default:
                console.error('Unsupported network');
            }

            const abi = [
  {
    "inputs": [],
    "stateMutability": "nonpayable",
    "type": "constructor",
    "signature": "constructor"
  },
  {
    "inputs": [],
    "name": "contractMove",
    "outputs": [
      {
        "internalType": "enum RSPSinglePlayerGS.Move",
        "name": "",
        "type": "uint8"
      }
    ],
    "stateMutability": "view",
    "type": "function",
    "constant": true,
    "signature": "0xa2b3198b"
  },
  {
    "inputs": [
      {
        "internalType": "enum RSPSinglePlayerGS.Move",
        "name": "move",
        "type": "uint8"
      },
      {
        "internalType": "string",
        "name": "secret",
        "type": "string"
      }
    ],
    "name": "join",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function",
    "signature": "0xc95468db"
  },
  {
    "inputs": [
      {
        "internalType": "enum RSPSinglePlayerGS.Move",
        "name": "joinMove",
        "type": "uint8"
      },
      {
        "internalType": "string",
        "name": "secret",
        "type": "string"
      }
    ],
    "name": "joinAndReveal",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function",
    "signature": "0x191a02d1"
  },
  {
    "inputs": [],
    "name": "player",
    "outputs": [
      {
        "internalType": "address",
        "name": "addr",
        "type": "address"
      },
      {
        "internalType": "bytes32",
        "name": "moveHash",
        "type": "bytes32"
      },
      {
        "internalType": "enum RSPSinglePlayerGS.Move",
        "name": "move",
        "type": "uint8"
      }
    ],
    "stateMutability": "view",
    "type": "function",
    "constant": true,
    "signature": "0x48db5f89"
  },
  {
    "inputs": [],
    "name": "reset",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function",
    "signature": "0xd826f88f"
  },
  {
    "inputs": [
      {
        "internalType": "enum RSPSinglePlayerGS.Move",
        "name": "move",
        "type": "uint8"
      },
      {
        "internalType": "string",
        "name": "secret",
        "type": "string"
      }
    ],
    "name": "reveal",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function",
    "signature": "0xca3ed9e8"
  },
  {
    "inputs": [],
    "name": "winner",
    "outputs": [
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      }
    ],
    "stateMutability": "view",
    "type": "function",
    "constant": true,
    "signature": "0xdfbf53ae"
  }
]; 
            
            const gameContract = new web3.eth.Contract(abi, contractAddress);

            document.getElementById('joinButton').addEventListener('click', async () => {
                const selectedMove = document.getElementById('move').value;
                const secret = document.getElementById('secret').value;
                const moveValue = moves[selectedMove];
                const accounts = await web3.eth.getAccounts();
                await gameContract.methods.joinAndReveal(moveValue, secret).send({from: accounts[0]});
                const contractMove = await gameContract.methods.contractMove().call();
                document.getElementById('status').innerText = "You joined the game";
                document.getElementById('contractMove').innerText = "Contract chose: " + moves[contractMove];
                document.getElementById('status').innerText = "Your move";
                const winner = await gameContract.methods.winner().call();
                if (winner == accounts[0]) {
                    document.getElementById('winner').innerText = "You won!";
                } else if (winner == contractAddress) {
                    document.getElementById('winner').innerText = "You lost!";
                } else {
                    document.getElementById('winner').innerText = "It's a tie!";
                }
            });

            document.getElementById('resetButton').addEventListener('click', async () => {
                const accounts = await web3.eth.getAccounts();
                await gameContract.methods.reset().send({from: accounts[0]});
                document.getElementById('status').innerText = "Game reset";
                document.getElementById('contractMove').innerText = "";
                document.getElementById('winner').innerText = "";
            });
        });
    </script>
</body>
</html>
